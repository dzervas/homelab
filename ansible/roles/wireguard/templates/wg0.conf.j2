# Managed by Ansible
[Interface]
ListenPort = 51820
PrivateKey = {{ wireguard_private_key.content | b64decode }}
Address = {{ hostvars[inventory_hostname].wireguard_ip }}/24
DNS = 1.1.1.1, 1.0.0.1

MTU = 1420
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

{% for peer in groups.all %}
{% if peer != inventory_hostname %}
[Peer]
PublicKey = {{ hostvars[peer].wireguard_public_key.content | b64decode }}
AllowedIPs = {{ hostvars[peer].wireguard_ip }}/32
Endpoint = {{ hostvars[peer].address }}:51820
PersistentKeepalive = 25
{% endif %}
{% endfor %}
